<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>EduConnect ‚Äì Azerbaijani School Forum & Community</title>
  <meta name="description" content="EduConnect - Join school communities, share knowledge and your skills" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LWPMR1LFFS"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-LWPMR1LFFS');
</script>

  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --primary-color: #2563eb;
      --primary-hover: #1e40af;
      --secondary-color: #f1f5f9;
      --accent-color: #0ea5e9;
      --success-color: #10b981;
      --warning-color: #f59e0b;
      --error-color: #ef4444;
      --text-primary: #1e293b;
      --text-secondary: #64748b;
      --text-light: #94a3b8;
      --border-color: #e2e8f0;
      --card-background: #ffffff;
      --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
      --border-radius: 8px;
      --border-radius-lg: 12px;
      --transition: all 0.2s ease-in-out;
    }
    body {
      font-family: 'Inter', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      line-height: 1.6;
    }
    .registration-container { width: 100%; max-width: 500px; }
    .registration-card { 
      background: var(--card-background); 
      border-radius: var(--border-radius-lg); 
      box-shadow: var(--shadow-lg); 
      overflow: hidden; 
      min-height: 850px; 
      animation: slideUp 0.6s ease-out; 
      padding-bottom: 20px;
    }
    @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
    .header { 
      padding: 32px; 
      text-align: center; 
      background: linear-gradient(135deg, var(--primary-color), var(--accent-color)); 
      color: white; 
      border-top-left-radius: var(--border-radius-lg);
      border-top-right-radius: var(--border-radius-lg);
    }
    .header h1 { font-size: 28px; font-weight: 700; margin-bottom: 8px; }
    .registration-form { padding: 32px; }
    .form-group { margin-bottom: 24px; position: relative; }
    .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-primary); font-size: 14px; }
    .form-group input { width: 100%; padding: 12px 16px; border: 2px solid var(--border-color); border-radius: var(--border-radius); font-size: 16px; transition: var(--transition); }
    .form-group input:focus { border-color: var(--primary-color); outline: none; }
    .password-input-wrapper { position: relative; }
    .toggle-password { position: absolute; right: 16px; top: 50%; transform: translateY(-50%); cursor: pointer; color: var(--text-light); font-size: 18px; transition: var(--transition); user-select:none; }
    .toggle-password:hover { color: var(--primary-color); }
    .avatar-upload { border: 2px dashed var(--border-color); border-radius: var(--border-radius-lg); padding: 24px; text-align: center; cursor: pointer; transition: var(--transition); }
    .avatar-upload:hover { border-color: var(--primary-color); background: var(--secondary-color); }
    .avatar-preview { width: 80px; height: 80px; margin: 0 auto 16px; border-radius: 50%; overflow: hidden; background: var(--secondary-color); display: flex; align-items: center; justify-content: center; font-size: 40px; color: var(--text-light); }
    .avatar-preview img { width: 100%; height: 100%; object-fit: cover; }
    .password-strength { height: 6px; border-radius: 3px; margin-top: 6px; transition: var(--transition); }
    .strength-weak { background: var(--error-color); width: 33%; }
    .strength-medium { background: var(--warning-color); width: 66%; }
    .strength-strong { background: var(--success-color); width: 100%; }
    .checkbox-label { display: flex; align-items: center; font-size: 14px; color: var(--text-secondary); cursor: pointer; gap:6px; }
    .checkbox-label input[type="checkbox"] { margin:0; width:18px; height:18px; vertical-align:middle; }
    .checkmark { width: 18px; height: 18px; border: 2px solid var(--border-color); border-radius: 4px; display:flex; align-items:center; justify-content:center; }
    .checkbox-label input:checked + .checkmark { background: var(--primary-color); border-color: var(--primary-color); }
    .submit-btn { width: 100%; padding: 14px 24px; background: linear-gradient(135deg, var(--primary-color), var(--accent-color)); color: white; border: none; border-radius: var(--border-radius); font-size: 16px; font-weight: 600; cursor: pointer; transition: var(--transition); }
    .submit-btn:hover { background: linear-gradient(135deg, var(--primary-hover), #0284c7); }
    .submit-btn:disabled { opacity: 0.6; cursor: not-allowed; }
    .error-message { color: var(--error-color); font-size: 12px; margin-top: 4px; }
    .loader { border: 3px solid var(--secondary-color); border-top: 3px solid var(--primary-color); border-radius: 50%; width: 16px; height: 16px; animation: spin 1s linear infinite; display: inline-block; margin-right: 8px; vertical-align: middle; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .form-row { display: flex; gap: 16px; }
    .form-row .form-group { flex:1; }
    @media (max-width: 600px) { .form-row { flex-direction: column; gap:0; } }
    .separator { text-align:center; margin-top:20px; }
    .thin-line { border:0; height:1px; background: var(--border-color); margin-bottom:10px; }
    .signin-text { font-size:14px; color: var(--text-secondary); }
    .signin-text a { color: var(--primary-color); text-decoration:underline; margin-left:4px; font-weight:600; }
    .signin-text a:hover { color: var(--primary-hover); }
  </style>
</head>
<body>
<div class="registration-container">
  <div class="registration-card">
    <div class="header">
      <h1>Join EduConnect</h1>
      <p>Connect with classmates, share knowledge, create quizzes & flashcards, and level up your learning!</p>
    </div>

    <form class="registration-form" id="registrationForm" novalidate>
      <div class="form-row">
        <div class="form-group">
          <label for="firstName">First Name</label>
          <input type="text" id="firstName" required />
          <span class="error-message" id="firstNameError"></span>
        </div>
        <div class="form-group">
          <label for="lastName">Last Name</label>
          <input type="text" id="lastName" required />
          <span class="error-message" id="lastNameError"></span>
        </div>
      </div>

      <div class="form-group">
        <label for="email">Email Address</label>
        <input type="email" id="email" required />
        <span class="error-message" id="emailError"></span>
      </div>

      <div class="form-group">
        <label for="password">Password</label>
        <div class="password-input-wrapper">
          <input type="password" id="password" required minlength="8" />
          <span class="toggle-password" data-target="password">üëÅÔ∏è</span>
        </div>
        <div class="password-strength" id="passwordStrength"></div>
        <span class="error-message" id="passwordError"></span>
      </div>

      <div class="form-group">
        <label for="confirmPassword">Confirm Password</label>
        <div class="password-input-wrapper">
          <input type="password" id="confirmPassword" required minlength="8" />
          <span class="toggle-password" data-target="confirmPassword">üëÅÔ∏è</span>
        </div>
        <span class="error-message" id="confirmPasswordError"></span>
      </div>

      <div class="form-group avatar-group">
        <label>Upload Avatar</label>
        <div class="avatar-upload" id="avatarUpload">
          <div class="avatar-preview" id="avatarPreview">üë§</div>
          <p>Click or drag file to upload</p>
        </div>
        <input type="file" id="avatarInput" accept="image/png, image/jpeg" style="opacity:0; width:0; height:0; position:absolute;" />
        <span class="error-message" id="avatarError"></span>
      </div>

      <div class="form-group">
        <label class="checkbox-label">
          <input type="checkbox" id="termsCheckbox" />
          <span>I agree to the <a href="terms.html" target="_blank">Terms and Conditions</a></span>
        </label>
        <span class="error-message" id="termsError"></span>
      </div>

      <button type="submit" class="submit-btn" id="submitBtn">Create Account</button>
    </form>

    <div id="messageBox" style="margin-top:15px;font-weight:600;"></div>

    <div class="separator">
      <hr class="thin-line" />
      <p class="signin-text">
        Already have an account? 
        <a href="signin.html">Sign in here</a>
      </p>
    </div>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";
  import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-firestore.js";

document.addEventListener("DOMContentLoaded", () => {

  const firebaseConfig = {
    apiKey: "AIzaSyCkU8o1vz4Tmo0yVRFrlq2_1_eDfI_GPaA",
    authDomain: "educonnect-958e2.firebaseapp.com",
    projectId: "educonnect-958e2",
    storageBucket: "educonnect-958e2.appspot.com",
    messagingSenderId: "1044066506835",
    appId: "1:1044066506835:web:ad2866ebfe60aa90978ea6",
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const registrationForm = document.getElementById("registrationForm");
  const submitBtn = document.getElementById("submitBtn");
  const messageBox = document.getElementById("messageBox");
  const firstNameInput = document.getElementById("firstName");
  const lastNameInput = document.getElementById("lastName");
  const emailInput = document.getElementById("email");
  const passwordInput = document.getElementById("password");
  const confirmPasswordInput = document.getElementById("confirmPassword");
  const avatarInput = document.getElementById("avatarInput");
  const avatarUpload = document.getElementById("avatarUpload");
  const avatarPreview = document.getElementById("avatarPreview");
  const termsCheckbox = document.getElementById("termsCheckbox");

  const firstNameError = document.getElementById("firstNameError");
  const lastNameError = document.getElementById("lastNameError");
  const emailError = document.getElementById("emailError");
  const passwordError = document.getElementById("passwordError");
  const confirmPasswordError = document.getElementById("confirmPasswordError");
  const avatarError = document.getElementById("avatarError");
  const termsError = document.getElementById("termsError");
  const passwordStrength = document.getElementById("passwordStrength");

  let uploadedAvatarURL = "";

  // Toggle password visibility
  document.querySelectorAll(".toggle-password").forEach(icon => {
    icon.addEventListener("click", () => {
      const input = document.getElementById(icon.dataset.target);
      input.type = input.type === "password" ? "text" : "password";
    });
  });

  passwordInput.addEventListener("input", () => {
    const val = passwordInput.value;
    passwordStrength.className = "password-strength";
    if (val.length >= 8) passwordStrength.classList.add("strength-weak");
    if (/[A-Z]/.test(val) && /[0-9]/.test(val)) passwordStrength.classList.add("strength-medium");
    if (/[^A-Za-z0-9]/.test(val) && val.length >= 12) passwordStrength.classList.add("strength-strong");
  });

  avatarUpload.addEventListener("click", () => avatarInput.click());

  avatarInput.addEventListener("change", async (e) => {
    const file = e.target.files[0];
    if (!file) return;
    if (file.size > 2*1024*1024) { avatarError.textContent = "File must be < 2MB"; return; }
    avatarError.textContent = "";

    const reader = new FileReader();
    reader.onload = (ev) => { avatarPreview.innerHTML = `<img src="${ev.target.result}" alt="Avatar" />`; };
    reader.readAsDataURL(file);

    try {
      const formData = new FormData();
      formData.append("file", file);
      formData.append("upload_preset", "unsigned-presnt"); // —Ç–≤–æ–π upload preset

      const response = await fetch("https://api.cloudinary.com/v1_1/dpbobj2j2/image/upload", { method:"POST", body:formData });
      const data = await response.json();
      if (data.secure_url) uploadedAvatarURL = data.secure_url;
      else avatarError.textContent = "Failed to upload avatar";
    } catch(err) { avatarError.textContent = "Error uploading avatar"; }
  });

  registrationForm.addEventListener("submit", async (e) => {
    e.preventDefault();

    firstNameError.textContent = lastNameError.textContent = emailError.textContent = passwordError.textContent = confirmPasswordError.textContent = termsError.textContent = messageBox.textContent = "";

    let valid = true;

    if (!firstNameInput.value.trim()) { firstNameError.textContent="First name required"; valid=false; }
    if (!lastNameInput.value.trim()) { lastNameError.textContent="Last name required"; valid=false; }
    if (!/\S+@\S+\.\S+/.test(emailInput.value)) { emailError.textContent="Invalid email"; valid=false; }
    if (passwordInput.value.length < 8) { passwordError.textContent="Password min 8 chars"; valid=false; }
    if (passwordInput.value !== confirmPasswordInput.value) { confirmPasswordError.textContent="Passwords do not match"; valid=false; }
    if (!termsCheckbox.checked) { termsError.textContent="Accept terms first"; valid=false; }

    if (!valid) return;

    submitBtn.disabled = true;
    messageBox.style.color="black";
    messageBox.textContent = "Registering...";

    try {
      const userCredential = await createUserWithEmailAndPassword(auth, emailInput.value, passwordInput.value);
      const user = userCredential.user;

      await setDoc(doc(db,"users",user.uid),{
      firstName: firstNameInput.value.trim(),
      lastName: lastNameInput.value.trim(),
      email: emailInput.value.trim(),
      avatarUrl: uploadedAvatarURL,
      searchName: `${firstNameInput.value.trim()} ${lastNameInput.value.trim()}`.toLowerCase() // <-- –Ω–æ–≤–æ–µ –ø–æ–ª–µ –¥–ª—è –ø–æ–∏—Å–∫–∞
});


      messageBox.style.color = "green";
      messageBox.textContent = "Registration successful! Redirecting...";
      setTimeout(()=>window.location.href="./dashboard/dashboard.html",1200);
    } catch (err) {
    messageBox.style.color = "red";
    switch (err.code) {
      case "auth/email-already-in-use":
        emailError.textContent = "‚ö†Ô∏è This email is already registered.";
        break;
      case "auth/invalid-email":
        emailError.textContent = "‚ö†Ô∏è Please provide a valid email address.";
        break;
      case "auth/weak-password":
        passwordError.textContent = "‚ö†Ô∏è Password is too weak (use letters, numbers, and symbols).";
        break;
      case "auth/network-request-failed":
        messageBox.textContent = "‚ö†Ô∏è Network error. Please check your connection.";
        break;
      case "auth/too-many-requests":
        messageBox.textContent = "‚ö†Ô∏è Too many attempts. Please try again later.";
        break;
      default:
        messageBox.textContent = "‚ö†Ô∏è Unexpected error: " + err.message;
    }
  } finally {
    submitBtn.disabled = false;
  }
});

});
</script>
</body>
</html>
