<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign In - School Forum</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="signin-style.css" />
  </head>
  <body>
    <div class="signin-container">
      <div class="signin-card">
        <div class="header">
          <h1>Welcome Back</h1>
          <p>Sign in to your EduConnect account</p>
        </div>

        <form class="signin-form" id="signinForm">
          <div class="form-group">
            <label for="email">Email Address</label>
            <input type="email" id="email" name="email" required />
            <span class="error-message" id="emailError"></span>
          </div>

          <div class="form-group">
            <label for="password">Password</label>
            <div class="password-input-wrapper">
              <input type="password" id="password" name="password" required />
              <button type="button" class="password-toggle" id="passwordToggle" aria-label="Toggle password visibility">
                <svg class="eye-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                  <circle cx="12" cy="12" r="3"></circle>
                </svg>
              </button>
            </div>
            <span class="error-message" id="passwordError"></span>
          </div>

          <div class="form-options">
            <label class="checkbox-label">
              <input type="checkbox" id="remember" />
              <span class="checkmark"></span>
              Remember me
            </label>
          </div>

          <button type="submit" class="submit-btn" id="submitBtn">
            <span class="btn-text">Sign In</span>
            <div class="btn-loader" id="btnLoader" style="display:none;">
              <div class="loader-spinner"></div>
            </div>
          </button>

          <!-- Сообщение об ошибке / успехе -->
          <div id="messageBox" style="margin-top:12px; font-weight:600; text-align:center;"></div>
        </form>

        <div class="register-link">
          <p>Don't have an account? <a href="index.html">Create one here</a></p>
        </div>
      </div>
    </div>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
      import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-auth.js";

      const firebaseConfig = {
      apiKey: "AIzaSyCkU8o1vz4Tmo0yVRFrlq2_1_eDfI_GPaA",
      authDomain: "educonnect-958e2.firebaseapp.com",
      projectId: "educonnect-958e2",
      storageBucket: "educonnect-958e2.firebasestorage.com",
      messagingSenderId: "1044066506835",
      appId: "1:1044066506835:web:ad2866ebfe60aa90978ea6",
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);

      const form = document.getElementById('signinForm');
      const messageBox = document.getElementById('messageBox');
      const btnLoader = document.getElementById('btnLoader');
      const submitBtn = document.getElementById('submitBtn');

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        messageBox.textContent = '';
        messageBox.style.color = 'red';
        btnLoader.style.display = 'inline-block';
        submitBtn.disabled = true;

        const email = form.email.value.trim();
        const password = form.password.value;

        try {
          const userCredential = await signInWithEmailAndPassword(auth, email, password);
          const user = userCredential.user;

          messageBox.style.color = 'green';
          messageBox.textContent = `Добро пожаловать, ${user.email}! Перенаправляем...`;

          setTimeout(() => {
            window.location.href = './dashboard/dashboard.html';
          }, 1500);
        } catch (error) {
          const errorCode = error.code;

          let userFriendlyMessage = 'Произошла ошибка. Попробуйте снова.';

          switch (errorCode) {
            case 'auth/invalid-credential':
            case 'auth/user-not-found':
            case 'auth/wrong-password':
              userFriendlyMessage = 'Неверный email или пароль';
              break;
            case 'auth/too-many-requests':
              userFriendlyMessage = 'Слишком много попыток. Попробуйте позже.';
              break;
            case 'auth/network-request-failed':
              userFriendlyMessage = 'Ошибка сети. Проверьте подключение.';
              break;
          }

          messageBox.textContent = userFriendlyMessage;
        } finally {
          btnLoader.style.display = 'none';
          submitBtn.disabled = false;
        }
      });

      // Переключение видимости пароля
      const passwordInput = document.getElementById('password');
      const toggleBtn = document.getElementById('passwordToggle');
      toggleBtn.addEventListener('click', () => {
        passwordInput.type = passwordInput.type === 'password' ? 'text' : 'password';
      });
    </script>
  </body>
</html>
