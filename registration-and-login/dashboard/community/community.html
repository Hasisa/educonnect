<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Community Profile - EduConnect</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />

    <!-- Styles -->
    <link rel="stylesheet" href="style7.css" />

    <!-- Font Awesome Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
</head>
<body>
    <!-- Header/Navigation -->
    <header class="header" role="banner">
        <div class="container">
            <div class="logo">
                <a href="/" class="logo-text" aria-label="Go to Dashboard">EduConnect</a>
            </div>
            
            <nav class="nav-menu" aria-label="Main navigation" role="navigation">
                <ul class="nav-list">
                    <li><a href="../homefeed/homefeed.html" class="nav-link active" aria-current="page">Home Feed</a></li>
                    <li><a href="../materials/materials.html" class="nav-link">Lesson Categories</a></li>
                    <li><a href="../communities/communities.html" class="nav-link">Communities</a></li>
                    <li><a href="../dashboard.html" class="nav-link">Dashboard</a></li>
                    <li><a href="../tools/tools.html" class="nav-link">Tools</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content" role="main">
        <div class="container">
            <!-- Loading State -->
            <div class="loading-container" id="loadingState" aria-live="polite">
                <div class="spinner" aria-hidden="true"></div>
                <p>Loading community...</p>
            </div>

            <!-- Error State -->
            <div class="error-container" id="errorState" style="display: none;" role="alert" aria-live="assertive">
                <div class="error-message">
                    <i class="fa-solid fa-triangle-exclamation" aria-hidden="true"></i>
                    <h3>Something went wrong</h3>
                    <p id="errorText">Failed to load community details</p>
                    <button class="btn btn-primary" id="retryBtn" type="button">Try Again</button>
                </div>
            </div>

            <!-- Community Content -->
            <div class="community-content" id="communityContent" style="display: none;">
                <!-- Community Header -->
                <section class="community-header" aria-labelledby="communityTitle">
                    <div class="community-info">
                        <div class="community-avatar">
                            <img id="communityAvatar" src="" alt="Avatar of community" class="avatar-img" />
                        </div>
                        <div class="community-details">
                            <h1 id="communityTitle" class="community-title"></h1>
                            <div class="community-meta" aria-label="Community details">
                                <span class="community-type" id="communityType"></span>
                                <span class="community-members" id="communityMembers"></span>
                                <span class="community-created" id="communityCreated"></span>
                            </div>
                            <p class="community-description" id="communityDescription"></p>
                        </div>
                    </div>
                    <div class="community-actions">
                        <button class="btn btn-outline" id="joinLeaveBtn" type="button" aria-live="polite" aria-atomic="true">
                            <i class="fa-solid fa-plus" id="joinLeaveIcon" aria-hidden="true"></i>
                            <span id="joinLeaveText">Join Community</span>
                        </button>
                    </div>
                </section>

                <!-- Posts Section -->
                <section class="posts-section" aria-labelledby="postsTitle">
                    <div class="section-header">
                        <h2 id="postsTitle">Recent Discussions</h2>
                        <div class="post-count" aria-live="polite">
                            <span id="postCount">0</span> posts
                        </div>
                    </div>

                    <!-- Add Post Form -->
                    <div class="add-post-container" id="addPostContainer" style="display: none;">
                        <form class="add-post-form" id="addPostForm">
                            <div class="form-group">
                                <label for="postContent" class="sr-only">Write your post</label>
                                <textarea 
                                    id="postContent" 
                                    class="post-textarea" 
                                    placeholder="Share your thoughts with the community..."
                                    rows="4"
                                    required
                                    aria-describedby="post-help"
                                    maxlength="500"
                                ></textarea>
                                <div id="post-help" class="form-help">
                                    <span class="char-count" id="charCount">0/500</span>
                                </div>
                            </div>

                            <!-- File Upload -->
                            <div class="form-group">
                                <label for="postDocument" class="custom-file-upload" tabindex="0" role="button" aria-label="Attach document">
                                    <i class="fa-solid fa-upload" aria-hidden="true"></i> Attach document
                                </label>
                                <input 
                                    type="file" 
                                    id="postDocument" 
                                    accept=".jpg,.jpeg,.png,.pdf,.doc,.docx,.xls,.xlsx,.txt"
                                    aria-describedby="document-help"
                                    style="display:none;"
                                />
                                <span id="selectedFileName" style="margin-left: 10px; font-size: 0.9em;"></span>
                            </div>

                            <div class="form-actions">
                                <button type="button" class="btn btn-outline" id="cancelPostBtn">Cancel</button>
                                <button type="submit" class="btn btn-primary" id="submitPostBtn">
                                    <i class="fa-solid fa-paper-plane"></i>
                                    Post
                                </button>
                            </div>
                        </form>
                    </div>

                    <script>
                        const fileInput = document.getElementById('postDocument');
                        const fileNameSpan = document.getElementById('selectedFileName');
                        fileInput.addEventListener('change', () => {
                            if (fileInput.files.length > 0) {
                                fileNameSpan.textContent = fileInput.files[0].name;
                            } else {
                                fileNameSpan.textContent = '';
                            }
                        });
                    </script>

                    <!-- Login Prompt -->
                    <div class="login-prompt" id="loginPrompt" style="display: none;" role="alert" aria-live="assertive">
                        <div class="prompt-content">
                            <i class="fa-solid fa-right-to-bracket" aria-hidden="true"></i>
                            <p>Please log in to participate in discussions</p>
                            <button class="btn btn-primary" id="loginBtn" type="button">Sign In</button>
                        </div>
                    </div>

                    <!-- Show Add Post Button -->
                    <button class="btn btn-primary add-post-btn" id="showAddPostBtn" style="display: none;" type="button" aria-label="Start a new discussion">
                        <i class="fa-solid fa-plus"></i>
                        Start a Discussion
                    </button>

                    <!-- Posts Feed -->
                    <div class="posts-feed" id="postsFeed" aria-live="polite" aria-busy="false">
                        <!-- Posts Loading -->
                        <div class="posts-loading" id="postsLoading">
                            <div class="spinner" aria-hidden="true"></div>
                            <p>Loading discussions...</p>
                        </div>

                        <!-- No Posts State -->
                        <div class="no-posts" id="noPosts" style="display: none;">
                            <div class="empty-state">
                                <i class="fa-solid fa-comments" aria-hidden="true"></i>
                                <h3>No discussions yet</h3>
                                <p>Be the first to start a conversation in this community!</p>
                            </div>
                        </div>

                        <!-- Posts Container -->
                        <div class="posts-container" id="postsContainer"></div>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js" defer></script>

    <!-- Config & App Scripts -->
    <script src="firebase-config.js" defer></script>
    <script src="script.js" defer></script>
</body>
</html>
